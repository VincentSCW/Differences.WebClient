<article class="media">
  <figure class="media-left">
    <ngx-avatar [name]="data.user.displayName" size="40"></ngx-avatar>
  </figure>
  <div class="media-content">
    <div class="content" (mouseover)="showStatusBar=true" (mouseout)="showStatusBar=false">
      <div class="level">
        <div class="level-left">
          <a [routerLink]="['/users', data.user.id]">{{data.user.displayName}}</a>
        </div>
        <div class="level-right">{{data.createTime | amTimeAgo}}</div>
      </div>
      <div *ngIf="isReadonly === true" [innerHTML]="newContent">
      </div>
      <ez-quill-editor [(ngModel)]="newContent" *ngIf="isReadonly === false">
      </ez-quill-editor>
      <div class="action-bar" *ngIf="isReadonly === false">
        <button mat-icon-button (click)="onSubmit()">
          <mat-icon class="icon-highlight">check</mat-icon>
        </button>
        <button mat-icon-button (click)="onCancel()">
          <mat-icon class="icon-normal">close</mat-icon>
        </button>
      </div>

      <nav class="level" *ngIf="isReadonly === true">
        <div class="level-left"></div>
        <div class="level-right" [style.visibility]="alwaysShowActionbar || showStatusBar ? 'visible': 'hidden'">
          <a matTooltip="编辑" class="level-item" (click)="onEdit()" *ngIf="currentUser != null && currentUser.id == data.user.id">
            <span class="icon is-small">
              <i class="fa fa-edit"></i>
            </span>
          </a>
          <a matTooltip="回复" class="level-item" *ngIf="replyEnabled" (click)="toggleEditPanel()">
            <span class="icon is-small">
              <i class="fa fa-reply"></i>
            </span>
          </a>
          <!-- <a class="level-item">
            <span class="icon is-small">
              <i class="fa fa-heart"></i>
            </span>
          </a> -->
        </div>
      </nav>
    </div>

    <div *ngIf="data.subReplies != null && data.subReplies.length > 0" class="box">
      <div *ngFor="let sub of data.subReplies" class="level">
        <div class="level-left">
          <span class="icon is-small sub-item-icon">
            <i class="far fa-hand-point-right"></i>
          </span>
          <a [routerLink]="['/users', sub.user.id]">{{sub.user.displayName}}</a>：
          <div class="content" [(innerHTML)]="sub.content">
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="showEditPanel">
      <mat-form-field class="full-width">
        <textarea matInput #replyTextarea class="textarea" minlength="5" maxlength="200" [(ngModel)]="myReplyContent">
        </textarea>
        <mat-hint align="end">{{myReplyContent?.length || 0}} / 200</mat-hint>
      </mat-form-field>
      <button-group (submit)="onReplySubmit()"
        (cancel)="toggleEditPanel()" [isValid]="true"></button-group>
    </div>
  </div>
</article>